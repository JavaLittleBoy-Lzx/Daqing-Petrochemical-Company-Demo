# 车辆有效信息查询接口说明

## 接口概述
根据车牌号码查询Oracle数据库中 `aentranceguard.view_autovalidinfo` 视图的车辆有效信息记录。

## 接口信息

### 请求方式
```
GET /api/oracle/vehicle/query
```

### 请求参数

| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| plateNumber | String | 是 | 车牌号码 | 京A12345 |

### 请求示例

#### 使用浏览器或Postman
```
GET http://localhost:8080/api/oracle/vehicle/query?plateNumber=京A12345
```

#### 使用curl
```bash
curl -X GET "http://localhost:8080/api/oracle/vehicle/query?plateNumber=京A12345"
```

#### 使用PowerShell
```powershell
Invoke-RestMethod -Uri "http://localhost:8080/api/oracle/vehicle/query?plateNumber=京A12345" -Method Get
```

## 响应格式

### 成功响应（查询到记录）
```json
{
  "success": true,
  "code": 20000,
  "message": "查询成功",
  "data": {
    "plateNumber": "京A12345",
    "count": 2,
    "list": [
      {
        "recordnoL": "20260115001",
        "recordno": "REC001",
        "cardNo": "CARD123456",
        "plateNumber": "京A12345",
        "plateColorCode": "1",
        "plateColorName": "蓝色",
        "vehicleCategoryCode": "K31",
        "vehicleCategoryName": "小型汽车",
        "vehicleTypeCode": "01",
        "vehicleTypeName": "轿车",
        "brandModel": "丰田凯美瑞",
        "companyName": "大庆石化公司",
        "driverName": "张三",
        "code": "CODE001",
        "areaCode": "01",
        "areaName": "化工西门",
        "validStartTime": "2026-01-01T00:00:00",
        "validEndTime": "2026-12-31T23:59:59",
        "statusCode": "1",
        "statusName": "有效",
        "isCheck": "0",
        "checkName": "正常",
        "operateTime": "2026-01-15 10:30:00"
      }
    ]
  }
}
```

### 成功响应（未查询到记录）
```json
{
  "success": true,
  "code": 20000,
  "message": "未查询到该车牌的记录",
  "data": {
    "plateNumber": "京A12345",
    "count": 0,
    "list": []
  }
}
```

### 错误响应（参数为空）
```json
{
  "success": false,
  "code": 20001,
  "message": "车牌号码不能为空",
  "data": {}
}
```

### 错误响应（查询失败）
```json
{
  "success": false,
  "code": 20001,
  "message": "查询失败: 数据库连接异常",
  "data": {}
}
```

## 响应字段说明

### 车辆信息字段（list数组中的对象）

| 字段名 | 类型 | 说明 |
|--------|------|------|
| recordnoL | String | 记录号L |
| recordno | String | 记录号 |
| cardNo | String | 卡号 |
| plateNumber | String | 车牌号码 |
| plateColorCode | String | 号牌颜色代码 |
| plateColorName | String | 号牌颜色名称 |
| vehicleCategoryCode | String | 车辆种类代码 |
| vehicleCategoryName | String | 车辆种类名称 |
| vehicleTypeCode | String | 车辆类型代码 |
| vehicleTypeName | String | 车辆类型名称 |
| brandModel | String | 品牌型号 |
| companyName | String | 单位名称 |
| driverName | String | 驾驶员姓名 |
| code | String | 代码 |
| areaCode | String | 厂区代码 |
| areaName | String | 厂区名称 |
| validStartTime | DateTime | 有效期开始时间 |
| validEndTime | DateTime | 有效期结束时间 |
| statusCode | String | 当前状态代码 |
| statusName | String | 当前状态名称 |
| isCheck | String | 是否检查 |
| checkName | String | 检查名称 |
| operateTime | String | 操作时间 |

## 数据来源

### Oracle视图
```sql
aentranceguard.view_autovalidinfo
```

### 查询SQL
```sql
SELECT RECORDNOL, RECORDNO, KH, CPHM, HPYS, HPYSNAME, CLZL, CLZLNAME, 
       CLLX, CLLXNAME, PPXH, DWMCNAME, JSYXM, CODE, CQDM, CQDMNAME, 
       KYXQKSSJ, KYXQJSSJ, DQZT, DQZTNAME, ISCHECK, ISCHECKNAME, CZSJ 
FROM aentranceguard.view_autovalidinfo 
WHERE CPHM = ? 
ORDER BY CZSJ DESC
```

## 使用场景

1. **车辆信息查询**：根据车牌号查询车辆的基本信息和有效期
2. **权限验证**：检查车辆是否有进入厂区的权限
3. **黑名单检查**：通过 `isCheck` 和 `checkName` 字段判断车辆是否需要特殊检查
4. **历史记录查询**：查询车辆的所有历史记录（按操作时间倒序）

## 注意事项

1. **车牌号格式**：支持各种车牌号格式，建议传入完整车牌号
2. **多条记录**：同一车牌可能有多条记录（历史记录），按操作时间倒序返回
3. **数据实时性**：查询的是Oracle数据库的实时数据
4. **权限要求**：需要有访问Oracle数据库的权限
5. **性能考虑**：建议对车牌号建立索引以提高查询性能

## 测试建议

1. 使用已知存在的车牌号进行测试
2. 测试不存在的车牌号，验证返回空列表
3. 测试空字符串和null值，验证参数校验
4. 检查返回的数据完整性和准确性

## 相关文件

- Controller: `src/main/java/com/parkingmanage/controller/OracleQueryController.java`
- Service: `src/main/java/com/parkingmanage/service/oracle/OracleQueryService.java`
- DTO: `src/main/java/com/parkingmanage/dto/oracle/VehicleValidInfoDTO.java`

## 版本历史

- v1.0 (2026-01-15): 初始版本，支持根据车牌号查询车辆有效信息
