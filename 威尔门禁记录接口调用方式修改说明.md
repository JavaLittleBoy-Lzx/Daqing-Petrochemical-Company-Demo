# 威尔门禁记录接口调用方式修改说明

## 修改内容

将威尔门禁记录接口的调用方式从"参数拼接在URL"改为"参数放在Body中"。

## 修改前

**请求方式：** POST  
**参数位置：** URL查询参数  
**Body：** 空字符串

```java
// 构建查询参数
Map<String, String> queryParams = new HashMap<>();
queryParams.put("pageIndex", String.valueOf(request.getPageIndex()));
queryParams.put("pageSize", String.valueOf(request.getPageSize()));
queryParams.put("beginTimestamp", String.valueOf(request.getBeginTimestamp()));
queryParams.put("endTimestamp", String.valueOf(request.getEndTimestamp()));

// 拼接URL
String fullUrl = url + "?pageIndex=1&pageSize=100&beginTimestamp=xxx&endTimestamp=xxx";

// 发送请求（空body）
String response = HttpClientUtil.doPostJsonWithHeaders(fullUrl, "", buildWellHeaders());
```

**示例请求：**
```
POST http://11.114.34.25:8888/api-gating/api-gating/open-dev-record/list?pageIndex=1&pageSize=100&beginTimestamp=1736899200000&endTimestamp=1736985600000
Headers:
  appKey: xxx
  sign: xxx
  timestamp: xxx
  version: xxx
Body: (空)
```

## 修改后

**请求方式：** POST  
**参数位置：** Request Body（JSON格式）  
**Body：** JSON对象

```java
// 构建请求Body参数
Map<String, Object> bodyParams = new HashMap<>();
bodyParams.put("pageIndex", request.getPageIndex());
bodyParams.put("pageSize", request.getPageSize());
bodyParams.put("beginTimestamp", request.getBeginTimestamp());
bodyParams.put("endTimestamp", request.getEndTimestamp());

// 转换为JSON字符串
String jsonBody = JSON.toJSONString(bodyParams);

// 发送请求（参数在Body中）
String response = HttpClientUtil.doPostJsonWithHeaders(url, jsonBody, buildWellHeaders());
```

**示例请求：**
```
POST http://11.114.34.25:8888/api-gating/api-gating/open-dev-record/list
Headers:
  appKey: xxx
  sign: xxx
  timestamp: xxx
  version: xxx
  Content-Type: application/json
Body:
{
  "pageIndex": 1,
  "pageSize": 100,
  "beginTimestamp": 1736899200000,
  "endTimestamp": 1736985600000
}
```

## 修改原因

1. **符合RESTful规范**：POST请求应该将参数放在Body中，而不是URL中
2. **更好的安全性**：敏感参数不会暴露在URL中
3. **更清晰的日志**：请求参数在Body中更容易查看和调试
4. **符合威尔接口规范**：威尔门禁接口要求使用POST方式并将参数放在Body中

## 影响范围

**修改文件：**
- `WellGateRecordService.java` - `getGateRecordList()` 方法

**影响功能：**
- 门禁记录查询
- 门禁记录同步任务
- 所有调用威尔门禁记录接口的功能

## 测试建议

1. 重启应用服务
2. 触发门禁记录同步任务
3. 检查日志中的请求Body是否正确
4. 确认能正常获取门禁记录数据

## 修改时间

2026-01-15
